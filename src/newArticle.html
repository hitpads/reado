<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/src/public/styles.css">
    <title>Write an Article | reado.</title>
</head>
<body>
<header>
    <h1>Create a New Article</h1>
    <nav>
        <a href="home.html">Home</a>
        <a href="profile.html">Profile</a>
    </nav>
</header>

<main>
    <form id="articleForm" enctype="multipart/form-data">
        <label for="title">Article Title:</label>
        <input type="text" id="title" name="title" placeholder="Enter the article title" required />

        <label for="content">Content:</label>
        <textarea id="content" name="content" rows="10" placeholder="Write your article content here..." required></textarea>

        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="public">Public</option>
            <option value="draft">Draft</option>
            <option value="archived">Archived</option>
        </select>

        <label for="tags">Tags:</label>
        <input type="text" id="tags" name="tags" placeholder="Enter tags (comma-separated)" />

        <label for="categories">Categories:</label>
        <!-- <select id="categories" name="categories">
            <option value="technology">Technology</option>
            <option value="science">Science</option>
            <option value="lifestyle">Lifestyle</option>
            <option value="news">News</option>
            <option value="other">Other</option>
        </select> -->

        <label for="thumbnail">Thumbnail:</label>
        <input type="file" id="thumbnail" name="thumbnail" accept="image/*" required />

        <button type="submit" id="postBtn">Post</button>
        <button type="button" id="cancelBtn">Cancel</button>
    </form>
</main>

<script>
    const form = document.getElementById('articleForm');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        formData.append('user', '6791ef8028051a0dc3ae6539'); // Replace 'USER_ID' with the actual user ID

        try {
            const response = await fetch('/admin/blogs/create-post', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('accessToken')}` // Assuming the token is stored in localStorage
                },
                body: formData,
            });

            if (response.ok) {
                alert('Article posted successfully!');
                window.location.href = 'profile.html';
            } else {
                const errMessage = await response.text();
                console.error('Error response:', errMessage);
                alert(`Error posting article: ${errMessage}`);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An unexpected error occurred while posting the article.');
        }
    });

    document.getElementById('cancelBtn').addEventListener('click', () => {
        window.location.href = 'home.html'; // Navigate back to the home page
    });
</script>
</body>
</html>