<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/src/public/styles.css">
    <title>Login or Register | reado.</title>
</head>
<body>
<header>
    <h1>Login or Register to reado.</h1>
</header>

<main>
    <div id="formContainer">
        <button id="toggleFormBtn">Switch to Register</button>

        <!-- Login Form -->
        <form id="loginForm">
            <h2>Login</h2>
            <label for="loginEmail">Email:</label>
            <input type="email" id="loginEmail" name="email" required />

            <label for="loginPassword">Password:</label>
            <input type="password" id="loginPassword" name="password" required />

            <label for="rememberMe">Remember Me:</label>
            <input type="checkbox" id="rememberMe" name="rememberMe" />

            <button type="submit">Login</button>
        </form>

        <!-- Register Form -->
        <form id="registerForm" style="display: none;">
            <h2>Register</h2>
            <label for="fullname">Full Name:</label>
            <input type="text" id="fullname" name="fullname" required />

            <label for="registerEmail">Email:</label>
            <input type="email" id="registerEmail" name="email" required />

            <label for="registerPassword">Password:</label>
            <input type="password" id="registerPassword" name="password" required />

            <label for="confirmPassword">Confirm Password:</label>
            <input type="password" id="confirmPassword" name="confirmPassword" required />

            <button type="submit">Register</button>
        </form>
    </div>
</main>

<script>
    const toggleFormBtn = document.getElementById('toggleFormBtn');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');

    toggleFormBtn.addEventListener('click', () => {
        if (loginForm.style.display === 'none') {
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
            toggleFormBtn.textContent = 'Switch to Register';
        } else {
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            toggleFormBtn.textContent = 'Switch to Login';
        }
    });

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const rememberMe = document.getElementById('rememberMe').checked;

        try {
            const response = await fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'deviceidentifier': 'DEVICE_IDENTIFIER' // Replace with actual device identifier
                },
                body: JSON.stringify({ email, password, rememberMe })
            });

            if (response.ok) {
                const data = await response.json();
                localStorage.setItem('accessToken', data.accessToken);
                localStorage.setItem('refreshToken', data.refreshToken);
                alert('Login successful!');
                window.location.href = 'profile.html';
            } else {
                const errMessage = await response.text();
                alert(`Error logging in: ${errMessage}`);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An unexpected error occurred while logging in.');
        }
    });

    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const fullname = document.getElementById('fullname').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        try {
            const response = await fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ fullname, email, password, confirmPassword })
            });

            if (response.ok) {
                alert('Registration successful!');
                window.location.href = 'login.html';
            } else {
                const errMessage = await response.text();
                alert(`Error registering: ${errMessage}`);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An unexpected error occurred while registering.');
        }
    });
</script>
</body>
</html>